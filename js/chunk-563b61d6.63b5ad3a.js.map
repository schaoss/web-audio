{"version":3,"sources":["webpack:///./src/views/GuitarTuner_2.vue?e5ad","webpack:///src/views/GuitarTuner_2.vue","webpack:///./src/views/GuitarTuner_2.vue?ad8a","webpack:///./src/views/GuitarTuner_2.vue","webpack:///./src/views/GuitarTuner_2.vue?8cab","webpack:///./node_modules/core-js/modules/es6.typed.float32-array.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","id","_v","on","click","clickHandler","staticClass","_s","getFrequencyStr","getNoteStr","getCentsOffStr","_l","n","key","style","height","timeArray","staticRenderFns","GuitarTuner_2vue_type_script_lang_js_","name","data","AudioContext","window","webkitAudioContext","audioCtx","gainNode","createGain","analyser","createAnalyser","gain","value","fftSize","connect","isPlaying","isMute","source","micStream","Float32Array","semiTone","centsOff","computed","getInputFrequency","MAX_SAMPLES","length","GOOD_ENOUGH_CORRELATION","correlations","Array","best_offset","best_correlation","last_correlation","foundGoodCorrelation","reduce","rms","d","Math","pow","offset","correlation","abs","shift","round","sampleRate","noteStr","methods","stop","play","destination","requestAnimationFrame","getMicData","disconnect","getUserMic","stream","createMediaStreamSource","getFloatTimeDomainData","getSemitone","getCentsOffFromPitch","f","log","getFrequencyFromSemitone","note","floor","mounted","navigator","mediaDevices","getUserMedia","audio","video","then","catch","e","console","beforeDestroy","getAudioTracks","views_GuitarTuner_2vue_type_script_lang_js_","component","Object","componentNormalizer","options","__file","__webpack_exports__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_GuitarTuner_2_vue_vue_type_style_index_0_id_22caafb3_lang_scss_scoped_true___WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_GuitarTuner_2_vue_vue_type_style_index_0_id_22caafb3_lang_scss_scoped_true___WEBPACK_IMPORTED_MODULE_0___default","init","byteOffset"],"mappings":"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","file":"js/chunk-563b61d6.63b5ad3a.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"guitar-tuner\"}},[_c('h1',[_vm._v(\"Guitar Tuner 2.0\")]),_c('button',{on:{\"click\":_vm.clickHandler}},[_vm._v(\" On / Off \")]),_c('div',{attrs:{\"id\":\"config\"}},[_c('div',{staticClass:\"audio-note\"},[_c('h3',[_vm._v(_vm._s(_vm.getFrequencyStr))]),_c('h2',[_vm._v(_vm._s(_vm.getNoteStr))]),_c('h4',[_vm._v(_vm._s(_vm.getCentsOffStr))]),_c('div',{staticClass:\"result\"},_vm._l((512),function(n){return _c('div',{key:n,staticClass:\"fftData\",style:({'height': _vm.timeArray[(n-1)]*200+2 + 'px'})})}))])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div id=\"guitar-tuner\">\n    <h1>Guitar Tuner 2.0</h1>\n    <button @click=\"clickHandler\"> On / Off </button>\n    <div id=\"config\">\n      <div class=\"audio-note\">\n        <h3>{{getFrequencyStr}}</h3>\n        <h2>{{getNoteStr}}</h2>\n        <h4>{{getCentsOffStr}}</h4>\n        <div class=\"result\">\n          <div class=\"fftData\" v-for=\"n in 512\" :key=\"n\" :style=\"{'height': timeArray[(n-1)]*200+2 + 'px'}\" />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"GuitarTuner2\",\n  data() {\n    const AudioContext = window.AudioContext || window.webkitAudioContext // 跨瀏覽器\n    const audioCtx = new AudioContext() // 主控台的概念\n    const gainNode = audioCtx.createGain() // 增益節點 控制音量的\n    const analyser = audioCtx.createAnalyser()\n\n    gainNode.gain.value = 0\n    analyser.fftSize = 2048\n    analyser.connect(gainNode)\n    return{\n      isPlaying: false,\n      isMute: false,\n      source: null,\n      audioCtx,\n      gainNode,\n      analyser,\n      micStream: null,\n      timeArray: new Float32Array(analyser.fftSize / 2),\n\n      semiTone: null,\n      centsOff: 0,\n    }\n  },\n  computed: {\n    getInputFrequency() {\n      const MAX_SAMPLES = this.timeArray.length / 2 // 由於需要重複測試才能判斷正確波長，故只能做到資料長度的一半\n      const GOOD_ENOUGH_CORRELATION = 0.9 // 相關係數要大於多少才接受\n      const correlations = new Array(MAX_SAMPLES)\n      let best_offset = -1\n      let best_correlation = 0\n      let last_correlation = 1\n      let foundGoodCorrelation  = false // 旗標 紀錄找到好的結果沒\n\n      if(this.timeArray.reduce((rms, d) => rms += d ** 2, 0) < 0.01) return -1\n\n      for(let offset = 0; offset < MAX_SAMPLES; offset++) {\n        let correlation = 0\n        for(let n = 0; n < MAX_SAMPLES; n++) {\n          correlation += Math.abs((this.timeArray[n])-(this.timeArray[n + offset]))\n        }\n        correlation = 1 - (correlation / MAX_SAMPLES) // 相關係數\n        correlations[offset] = correlation\n\n        if ((correlation > GOOD_ENOUGH_CORRELATION) && (correlation > last_correlation)) {\n          // 當找到足夠好的結果的時候\n          foundGoodCorrelation = true\n          if (correlation > best_correlation) {\n            best_correlation = correlation\n            best_offset = offset\n          }\n        } else if (foundGoodCorrelation) {\n          // 前一組為足夠好的結果，且當前的不夠好時\n          const shift = (correlations[best_offset + 1] - correlations[best_offset - 1]) / correlations[best_offset];  \n          return Math.round(this.audioCtx.sampleRate / (best_offset + (8 * shift)))\n        }\n        // 不好的結果\n        last_correlation = correlation\n      }\n      if (best_correlation > 0.01) {\n        return Math.round(this.audioCtx.sampleRate / best_offset)\n      }\n      return -1;\n    },\n    getFrequencyStr() {\n      return this.getInputFrequency > 0 ? this.getInputFrequency : '-'\n    },\n    getNoteStr() {\n      const noteStr = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B']\n      return this.semiTone ? noteStr[this.semiTone % 12] : '-'\n    },\n    getCentsOffStr() {\n      return this.centsOff < 0\n      ? Math.abs(this.centsOff) + ' b'\n      : this.centsOff > 0 \n        ? Math.abs(this.centsOff) + ' #'\n        : '-'\n    }\n  },\n  methods: {\n    clickHandler(){\n      if (this.isPlaying) {\n        this.stop()\n      } else {\n        this.play()\n      }\n    },\n    play() {\n      this.isPlaying = true\n      this.gainNode.connect(this.audioCtx.destination)\n      requestAnimationFrame(this.getMicData)\n    },\n    stop() {\n      this.isPlaying = false\n      this.gainNode.disconnect(this.audioCtx.destination)\n    },\n    getUserMic(stream) {\n      this.micStream = stream\n      this.source = this.audioCtx.createMediaStreamSource(stream)\n      this.source.connect(this.analyser)\n    },\n    getMicData(){\n      this.timeArray = new Float32Array(this.analyser.fftSize)\n      this.analyser.getFloatTimeDomainData(this.timeArray)\n      this.semiTone = this.getSemitone(this.getInputFrequency)\n      this.centsOff = this.getCentsOffFromPitch(this.getInputFrequency, this.semiTone)\n      if (this.isPlaying) requestAnimationFrame(this.getMicData)\n    },\n    getSemitone(f) {\n      return Math.round(12 * (Math.log(f / 440) / Math.log(2) )) + 69\n    },\n    getFrequencyFromSemitone(note) {\n\t    return 440 * Math.pow(2, (note - 69) / 12)\n    },\n    getCentsOffFromPitch(f, note) {\n      return Math.floor(1200 * Math.log(f / this.getFrequencyFromSemitone(note)) / Math.log(2))\n    }\n  },\n  mounted() {\n    navigator.mediaDevices.getUserMedia({ audio: true, video: false })\n    .then(this.getUserMic)\n    .catch(e => console.log(e))\n  },\n  beforeDestroy() {\n    if(this.micStream) this.micStream.getAudioTracks()[0].stop()\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\n#guitar-tuner {\n  > button {\n    margin: 10px;\n  }\n  #config {\n    display: flex;\n    justify-content: space-around;\n    flex-direction: column;\n    > .audio-note {\n      width: 1000px;\n      margin: 15px auto;\n      border: solid 1px #d9d9d9;\n      .result {\n        display: flex;\n        justify-content: center;\n        height: 300px;\n        vertical-align: middle;\n        align-items: center;\n        overflow: hidden;\n        .fftData {\n          display: block;\n          width: 2px;\n          background-color: #bf8f36;\n        }\n      }\n    }\n  }\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GuitarTuner_2.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GuitarTuner_2.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./GuitarTuner_2.vue?vue&type=template&id=22caafb3&scoped=true&\"\nimport script from \"./GuitarTuner_2.vue?vue&type=script&lang=js&\"\nexport * from \"./GuitarTuner_2.vue?vue&type=script&lang=js&\"\nimport style0 from \"./GuitarTuner_2.vue?vue&type=style&index=0&id=22caafb3&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"22caafb3\",\n  null\n  \n)\n\ncomponent.options.__file = \"GuitarTuner_2.vue\"\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/lib/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GuitarTuner_2.vue?vue&type=style&index=0&id=22caafb3&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/lib/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GuitarTuner_2.vue?vue&type=style&index=0&id=22caafb3&lang=scss&scoped=true&\"","require('./_typed-array')('Float32', 4, function (init) {\n  return function Float32Array(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n});\n"],"sourceRoot":""}
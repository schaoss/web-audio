{"version":3,"sources":["webpack:///./src/views/VoiceChanger.vue?3e02","webpack:///./src/views/VoiceChanger.vue?a5e2","webpack:///src/views/VoiceChanger.vue","webpack:///./src/views/VoiceChanger.vue?4df2","webpack:///./src/views/VoiceChanger.vue","webpack:///./node_modules/core-js/modules/es6.typed.float32-array.js"],"names":["_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_VoiceChanger_vue_vue_type_style_index_0_id_0f89a28c_lang_scss_scoped_true___WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_VoiceChanger_vue_vue_type_style_index_0_id_0f89a28c_lang_scss_scoped_true___WEBPACK_IMPORTED_MODULE_0___default","n","render","_vm","this","_h","$createElement","_c","_self","attrs","id","_v","on","click","clickHandler","staticClass","for","_s","pitchRatio","directives","name","rawName","value","expression","type","min","max","step","domProps","__r","$event","target","overlapRatio","_l","key","style","height","timeArray","staticRenderFns","VoiceChangervue_type_script_lang_js_","data","AudioContext","window","webkitAudioContext","audioCtx","gainNode","createGain","gain","isPlaying","source","micStream","Float32Array","bufferSize","methods","stop","play","connect","destination","disconnect","getUserMic","stream","_this","createMediaStreamSource","processor","createScriptProcessor","buffer","hannWindow","onaudioprocess","e","input","inputBuffer","getChannelData","output","outputBuffer","i","length","grainData","_i","j","parseFloat","index","Math","floor","a","b","linearInterpolation","_i2","round","_j","_i3","cos","PI","t","mounted","Object","audioUnlock","navigator","mediaDevices","getUserMedia","audio","video","then","catch","console","log","beforeDestroy","getAudioTracks","views_VoiceChangervue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__","init","byteOffset"],"mappings":"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","file":"js/chunk-d5487520.5766a56c.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VoiceChanger.vue?vue&type=style&index=0&id=0f89a28c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VoiceChanger.vue?vue&type=style&index=0&id=0f89a28c&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"voice-changer\"}},[_c('h1',[_vm._v(\"VoiceChanger\")]),_c('button',{on:{\"click\":_vm.clickHandler}},[_vm._v(\" On / Off \")]),_c('div',{attrs:{\"id\":\"config\"}},[_c('div',{staticClass:\"audio-note\"},[_c('div',{staticClass:\"item\"},[_c('label',{attrs:{\"for\":\"pitchRatio\"}},[_vm._v(\"頻率倍率 : \"),_c('span',[_vm._v(_vm._s(_vm.pitchRatio))])]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.pitchRatio),expression:\"pitchRatio\"}],attrs:{\"type\":\"range\",\"min\":\"0.5\",\"max\":\"2\",\"step\":\"0.01\",\"id\":\"pitchRatio\"},domProps:{\"value\":(_vm.pitchRatio)},on:{\"__r\":function($event){_vm.pitchRatio=$event.target.value}}})]),_c('div',{staticClass:\"item\"},[_c('label',{attrs:{\"for\":\"overlapRatio\"}},[_vm._v(\"重疊率 : \"),_c('span',[_vm._v(_vm._s(_vm.overlapRatio))])]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.overlapRatio),expression:\"overlapRatio\"}],attrs:{\"type\":\"range\",\"min\":\"0.1\",\"max\":\"1\",\"step\":\"0.01\",\"id\":\"overlapRatio\"},domProps:{\"value\":(_vm.overlapRatio)},on:{\"__r\":function($event){_vm.overlapRatio=$event.target.value}}})]),_c('div',{staticClass:\"result\"},_vm._l((512),function(n){return _c('div',{key:n,staticClass:\"timeData\",style:({'height': _vm.timeArray[(n-1)]*200+2 + 'px'})})}),0)])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div id=\"voice-changer\">\n    <h1>VoiceChanger</h1>\n    <button @click=\"clickHandler\"> On / Off </button>\n    <div id=\"config\">\n      <div class=\"audio-note\">\n        <div class=\"item\">\n          <label for=\"pitchRatio\">頻率倍率 : <span>{{pitchRatio}}</span> </label>\n          <input type=\"range\" min=\"0.5\" max=\"2\" step=\"0.01\" id=\"pitchRatio\" v-model=\"pitchRatio\">\n        </div>\n        <div class=\"item\">\n          <label for=\"overlapRatio\">重疊率 : <span>{{overlapRatio}}</span> </label>\n          <input type=\"range\" min=\"0.1\" max=\"1\" step=\"0.01\" id=\"overlapRatio\" v-model=\"overlapRatio\">\n        </div>\n        <div class=\"result\">\n          <div class=\"timeData\" v-for=\"n in 512\" :key=\"n\" :style=\"{'height': timeArray[(n-1)]*200+2 + 'px'}\" />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport audioUnlock from '../lib/audioUnlock'\nexport default {\n  name: \"VoiceChanger\",\n  data() {\n    const AudioContext = window.AudioContext || window.webkitAudioContext // 跨瀏覽器\n    const audioCtx = new AudioContext() // 主控台的概念\n    const gainNode = audioCtx.createGain() // 增益節點 控制音量的\n    gainNode.gain.value = 1\n\n    return{\n      isPlaying: false,\n      source: null,\n      audioCtx,\n      gainNode,\n      micStream: null,\n      timeArray: new Float32Array(1024),\n\n      pitchRatio: 1.0,\n      overlapRatio: 0.5,\n      bufferSize: 2048\n    }\n  },\n  methods: {\n    clickHandler(){\n      if (this.isPlaying) {\n        this.stop()\n      } else {\n        this.play()\n      }\n    },\n    play() {\n      this.isPlaying = true\n      this.gainNode.connect(this.audioCtx.destination)\n    },\n    stop() {\n      this.isPlaying = false\n      this.gainNode.disconnect(this.audioCtx.destination)\n    },\n    getUserMic(stream) {\n      this.micStream = stream\n      this.source = this.audioCtx.createMediaStreamSource(stream)\n      const processor = this.audioCtx.createScriptProcessor(this.bufferSize, 1, 1)\n      const buffer = new Float32Array(this.bufferSize * 2)\n      const hannWindow = this.hannWindow(this.bufferSize)\n\n      processor.onaudioprocess = (e) => {\n        const input = e.inputBuffer.getChannelData(0);\n        const output = e.outputBuffer.getChannelData(0);\n    \n        for (let i = 0; i < input.length; i++) {\n            input[i] *= hannWindow[i]\n\n            buffer[i] = buffer[i + this.bufferSize]\n            buffer[i + this.bufferSize] = 0.0\n        }\n\n        // 將輸入訊號依照頻率倍率重新計算\n        const grainData = new Float32Array(this.bufferSize)\n        for (let i = 0, j = 0.0;\n              i < this.bufferSize;\n              i++, j += parseFloat(this.pitchRatio)) {\n            let index = Math.floor(j) % this.bufferSize\n            let a = input[index]\n            let b = input[(index + 1) % this.bufferSize]\n\n            grainData[i] += this.linearInterpolation(a, b, j % 1.0) * hannWindow[i]\n        }\n\n        // 利用重疊，讓聲音聽起來較連續\n        for (let i = 0; i < this.bufferSize; i += Math.round(this.bufferSize * (this.overlapRatio))) {\n          for (let j = 0; j <= this.bufferSize; j++) {\n              buffer[i + j] += grainData[j]\n          }\n        }\n\n        // 將 buffer 內前半資料丟出去\n        for (let i = 0; i < this.bufferSize; i++) {\n          output[i] = buffer[i]\n        }\n        this.timeArray = output\n      }\n      this.source.connect(processor)\n      processor.connect(this.gainNode)\n    },\n    hannWindow(length) {\n      const window = new Float32Array(length)\n      for (var i = 0; i < length; i++) {\n          window[i] = 0.5 * (1 - Math.cos(2 * Math.PI * i / (length - 1)))\n      }\n      return window;\n    },\n    linearInterpolation(a, b, t) {\n      return a + (b - a) * t;\n    }\n  },\n  mounted() {\n    audioUnlock(this.audioCtx)\n    navigator.mediaDevices.getUserMedia({ audio: true, video: false })\n    .then(this.getUserMic)\n    .catch(e => console.log(e))\n  },\n  beforeDestroy() {\n    if(this.micStream) this.micStream.getAudioTracks()[0].stop()\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\n#voice-changer {\n  > button {\n    margin: 10px;\n  }\n  #config {\n    display: flex;\n    justify-content: space-around;\n    flex-direction: column;\n    > .audio-note {\n      width: 50vw;\n      min-width: 300px;\n      margin: 15px auto;\n      border: solid 1px #d9d9d9;\n      > h3 {\n        text-align: left;\n        margin: 10px;\n        > span {\n          display: inline-block;\n          width: 100px;\n          text-align: right;\n        }\n      }\n      > .item {\n        display: flex;\n        width: 100%;\n        max-width: 800px;\n        margin: 5px auto;\n        padding: 10px;\n        > label {\n          display: inline-block;\n          min-width: 150px;\n          text-align: right;\n          > span {\n            font-weight: 600;\n            display: inline-block;\n            width: 50px;\n            text-align: center;\n          }\n        }\n        > input {\n          width: 100%;\n          max-width: 600px;\n          margin: 0 20px;\n        }\n        > select {\n          margin: 0 20px;\n        }\n      }\n      .result {\n        display: flex;\n        justify-content: center;\n        height: 300px;\n        vertical-align: middle;\n        align-items: center;\n        overflow: hidden;\n        .timeData {\n          display: block;\n          width: 2px;\n          background-color: #36bf4b;\n        }\n      }\n    }\n  }\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VoiceChanger.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VoiceChanger.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./VoiceChanger.vue?vue&type=template&id=0f89a28c&scoped=true&\"\nimport script from \"./VoiceChanger.vue?vue&type=script&lang=js&\"\nexport * from \"./VoiceChanger.vue?vue&type=script&lang=js&\"\nimport style0 from \"./VoiceChanger.vue?vue&type=style&index=0&id=0f89a28c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0f89a28c\",\n  null\n  \n)\n\nexport default component.exports","require('./_typed-array')('Float32', 4, function (init) {\n  return function Float32Array(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n});\n"],"sourceRoot":""}
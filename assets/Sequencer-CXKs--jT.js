import{d as _e,u as we,j as Y,r as D,b as ke,e as be,c as y,f as o,s as v,w as K,F as k,i as b,q as W,o as g}from"./index-Dp99J6ZZ.js";import{j as J,o as L,c as T,k as Me,l as P,m as N,p as F,G as Z,q as C,r as xe,s as Ae,w as qe,i as Oe,I as ee,A as Se,t as te,E as Re,P as ne,f as oe,M as I,h as S,g as De}from"./index-BG3aqh2C.js";import{a as $e}from"./audioUnlock-CHVvazkl.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";class E extends J{constructor(){const e=L(E.getDefaults(),arguments,["type"]);super(e),this.name="Noise",this._source=null,this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(J.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(T(e in se,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const n=this.now();this._stop(n),this._start(n)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const n=se[this._type];this._source=new Me({url:n,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(n.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const $=44100*5,j=2,M={brown:null,pink:null,white:null},se={get brown(){if(!M.brown){const _=[];for(let e=0;e<j;e++){const n=new Float32Array($);_[e]=n;let i=0;for(let t=0;t<$;t++){const a=Math.random()*2-1;n[t]=(i+.02*a)/1.02,i=n[t],n[t]*=3.5}}M.brown=new P().fromArray(_)}return M.brown},get pink(){if(!M.pink){const _=[];for(let e=0;e<j;e++){const n=new Float32Array($);_[e]=n;let i,t,a,l,d,f,h;i=t=a=l=d=f=h=0;for(let A=0;A<$;A++){const p=Math.random()*2-1;i=.99886*i+p*.0555179,t=.99332*t+p*.0750759,a=.969*a+p*.153852,l=.8665*l+p*.3104856,d=.55*d+p*.5329522,f=-.7616*f-p*.016898,n[A]=i+t+a+l+d+f+h+p*.5362,n[A]*=.11,h=p*.115926}}M.pink=new P().fromArray(_)}return M.pink},get white(){if(!M.white){const _=[];for(let e=0;e<j;e++){const n=new Float32Array($);_[e]=n;for(let i=0;i<$;i++)n[i]=Math.random()*2-1}M.white=new P().fromArray(_)}return M.white}};class Q extends N{constructor(){const e=L(Q.getDefaults(),arguments,["frequency","type"]);super(e),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new F({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new F({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new F({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new F({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(N.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){T(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const n=new Float32Array(e);for(let l=0;l<e;l++){const f=Math.pow(l/e,2)*19980+20;n[l]=f}const i=new Float32Array(e),t=new Float32Array(e),a=this.context.createBiquadFilter();return a.type=this.type,a.Q.value=this.Q.value,a.frequency.value=this.frequency.value,a.gain.value=this.gain.value,a.getFrequencyResponse(n,i,t),i}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class G extends N{constructor(){const e=L(G.getDefaults(),arguments,["frequency","type","rolloff"]);super(e),this.name="Filter",this.input=new Z({context:this.context}),this.output=new Z({context:this.context}),this._filters=[],this._filters=[],this.Q=new C({context:this.context,units:"positive",value:e.Q}),this.frequency=new C({context:this.context,units:"frequency",value:e.frequency}),this.detune=new C({context:this.context,units:"cents",value:e.detune}),this.gain=new C({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,xe(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(N.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){T(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(i=>i.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const n=Oe(e)?e:parseInt(e,10),i=[-12,-24,-48,-96];let t=i.indexOf(n);T(t!==-1,`rolloff can only be ${i.join(", ")}`),t+=1,this._rolloff=n,this.input.disconnect(),this._filters.forEach(a=>a.disconnect()),this._filters=new Array(t);for(let a=0;a<t;a++){const l=new Q({context:this.context});l.type=this._type,this.frequency.connect(l.frequency),this.detune.connect(l.detune),this.Q.connect(l.Q),this.gain.connect(l.gain),this._filters[a]=l}this._internalChannels=this._filters,Ae(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const n=new Q({context:this.context,frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),i=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{n.getFrequencyResponse(e).forEach((a,l)=>i[l]*=a)}),n.dispose(),i}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),qe(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class H extends ee{constructor(){const e=L(H.getDefaults(),arguments);super(e),this.name="NoiseSynth",this.noise=new E(Object.assign({context:this.context},e.noise)),this.envelope=new Se(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(ee.getDefaults(),{envelope:Object.assign(te(Re.getDefaults(),Object.keys(N.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(te(E.getDefaults(),Object.keys(J.getDefaults())),{type:"white"})})}triggerAttack(e,n=1){return e=this.toSeconds(e),this.envelope.triggerAttack(e,n),this.noise.start(e),this.envelope.sustain===0&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(e,n,i=1){return n=this.toSeconds(n),e=this.toSeconds(e),this.triggerAttack(n,i),this.triggerRelease(n+e),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}class Fe{noise;poly;constructor({volume:e}){const n=new G({frequency:11e3}),i=new H({volume:e,noise:{type:"pink",playbackRate:3},envelope:{attack:.001,decay:.15,sustain:1e-4,release:.05}}).connect(n),t=new ne(oe,{volume:e+6,oscillator:{partials:[0,2,3,4]},envelope:{attack:.001,decay:.17,sustain:1e-4,release:.08,releaseCurve:"exponential"}});this.noise=i,this.poly=t,this.poly.maxPolyphony=6}trigger(e){return this.noise.triggerAttack(e),this.poly.triggerAttackRelease(["C2","D#2","G2"],"16n",e),this}toDestination(){return this.noise.toDestination(),this.poly.toDestination(),this}}const Ce={id:"sequencer"},Ie={id:"play"},Te={id:"bpm"},Ee=["value"],Qe={id:"timeLine"},Le={id:"drum",class:"set"},He={class:"kick"},Be=["name","onMousedown","onMouseenter","onTouchstart"],Pe={class:"hihat"},je=["name","onMousedown","onMouseenter"],Je={class:"snare"},Ge=["name","onMousedown","onMouseenter"],Ue={class:"tomL"},Ve=["name","onMousedown","onMouseenter"],ze={class:"tomM"},Xe=["name","onMousedown","onMouseenter"],Ye={class:"tomH"},Ke=["name","onMousedown","onMouseenter"],We={id:"lead",class:"set"},Ze=["name","onMousedown","onMouseenter"],et=_e({__name:"Sequencer",setup(_){const e=we(),{bpm:n="120"}=e.query,i=Y({drum:{kick:Array(16).fill(!1),hihat:Array(16).fill(!1),snare:Array(16).fill(!1),tomL:Array(16).fill(!1),tomM:Array(16).fill(!1),tomH:Array(16).fill(!1)},lead:Array.from({length:7},()=>Array(16).fill(!1))}),t=Y({drum:JSON.parse(JSON.stringify(i.drum)),lead:JSON.parse(JSON.stringify(i.lead))}),a=D(0),l=D(!1),d=D(!1),f=D(""),h=D(-1),A=new I({}).toDestination(),p=new I({octaves:1}).toDestination(),U=new I({octaves:1}).toDestination(),V=new I({octaves:1}).toDestination(),z=new H({}).toDestination(),ae=new Fe({volume:-6}).toDestination(),B=new ne(oe,{}).toDestination();B.maxPolyphony=8,A.volume.value=6,z.volume.value=-2,p.volume.value=0,U.volume.value=0,V.volume.value=0,B.set({volume:2});const x=D(Number(n)||120);S().bpm.value=x.value,S().scheduleRepeat(r=>{h.value=(h.value+1)%16,t.drum.kick[h.value]&&A.triggerAttackRelease("C1","8n",r),t.drum.hihat[h.value]&&z.triggerAttackRelease("16n",r),t.drum.snare[h.value]&&ae.trigger(r),t.drum.tomL[h.value]&&p.triggerAttackRelease("G1","8n",r),t.drum.tomM[h.value]&&U.triggerAttackRelease("C2","8n",r),t.drum.tomH[h.value]&&V.triggerAttackRelease("E2","8n",r),["C4","D4","E4","F4","G4","A4","C5"].forEach((s,c)=>{t.lead[c][h.value]&&B.triggerAttackRelease(s,"16n",r)})},"16n");function ie(){l.value?fe():de()}function re(){a.value=(a.value+1)%2}function le(){x.value=Math.max(40,x.value-5),S().bpm.value=x.value}function ue(){x.value=Math.min(300,x.value+5),S().bpm.value=x.value}function m(r,u){r[u]=!r[u]}function ce(){a.value===0?t.drum=JSON.parse(JSON.stringify(i.drum)):a.value===1&&(t.lead=JSON.parse(JSON.stringify(i.lead)))}function he(){a.value===0?t.drum={kick:q(),hihat:q(),snare:q(),tomL:q(),tomM:q(),tomH:q()}:a.value===1&&(t.lead=Array.from({length:7},q))}function q(r=16){return Array.from({length:r},()=>Math.random()>.8)}function de(){l.value=!0,S().start()}function fe(){l.value=!1,S().stop(),h.value=-1}function X(){setTimeout(()=>window.scrollTo(0,1),10)}function pe(){d.value=!0}function O(r,u){d.value&&m(r,u)}function me(){d.value=!1}function ye(r){d.value=!0,f.value=r.target.getAttribute("name")||""}function ve(r){if(!d.value)return;const{clientX:u,clientY:s}=r.targetTouches[0],w=document.elementFromPoint(u,s)?.getAttribute("name");if(w&&w!==f.value){f.value=w;const R=w.split("_");R[0]==="lead"?m(t.lead[parseInt(R[1])],parseInt(R[2])):m(t.drum[R[0]],parseInt(R[1]))}r.preventDefault()}function ge(){d.value=!1,f.value=""}return ke(()=>{$e(De());const r=document.querySelector("#menuTrigger");r&&(r.style.display="none"),window.addEventListener("load",X)}),be(()=>{const r=document.querySelector("#menuTrigger");r&&(r.style.display=""),S().stop(),window.removeEventListener("load",X)}),(r,u)=>(g(),y("div",Ce,[o("div",{id:"config",class:v({drum:a.value===0,lead:a.value===1})},[o("button",{onClick:re},[o("i",{class:v(["fas",{"fa-drum":a.value===0,"fa-music":a.value===1}])},null,2)]),o("button",{onClick:he},[...u[0]||(u[0]=[o("i",{class:"fas fa-random"},null,-1)])]),o("div",Ie,[o("button",{onClick:ie},[o("i",{class:v(["fas",{"fa-play":!l.value,"fa-pause":l.value}])},null,2)])]),o("div",Te,[o("button",{onClick:le},[...u[1]||(u[1]=[o("i",{class:"fas fa-minus"},null,-1)])]),o("input",{type:"text",value:x.value,readonly:""},null,8,Ee),u[3]||(u[3]=o("span",null,"bpm",-1)),o("button",{onClick:ue},[...u[2]||(u[2]=[o("i",{class:"fas fa-plus"},null,-1)])])]),o("button",{onClick:ce},[...u[4]||(u[4]=[o("i",{class:"fas fa-trash-alt"},null,-1)])])],2),o("div",{id:"pad",onMousedown:pe,onMouseup:me,onTouchstart:ye,onTouchend:ge,onTouchmove:ve},[o("div",Qe,[(g(),y(k,null,b(16,s=>o("div",{key:`time_${s-1}`,class:v(["time",{active:h.value===s-1}])},null,2)),64))]),K(o("div",Le,[o("ul",He,[(g(),y(k,null,b(16,s=>o("li",{key:`kick_${s-1}`,name:`kick_${s-1}`,class:v(["item",{active:!!t.drum.kick[s-1]}]),onMousedown:c=>m(t.drum.kick,s-1),onMouseenter:()=>O(t.drum.kick,s-1),onTouchstart:c=>m(t.drum.kick,s-1)},null,42,Be)),64))]),o("ul",Pe,[(g(),y(k,null,b(16,s=>o("li",{key:`hihat_${s-1}`,name:`hihat_${s-1}`,class:v(["item",{active:!!t.drum.hihat[s-1]}]),onMousedown:c=>m(t.drum.hihat,s-1),onMouseenter:()=>O(t.drum.hihat,s-1)},null,42,je)),64))]),o("ul",Je,[(g(),y(k,null,b(16,s=>o("li",{key:`snare_${s-1}`,name:`snare_${s-1}`,class:v(["item",{active:!!t.drum.snare[s-1]}]),onMousedown:c=>m(t.drum.snare,s-1),onMouseenter:()=>O(t.drum.snare,s-1)},null,42,Ge)),64))]),o("ul",Ue,[(g(),y(k,null,b(16,s=>o("li",{key:`tomL_${s-1}`,name:`tomL_${s-1}`,class:v(["item",{active:!!t.drum.tomL[s-1]}]),onMousedown:c=>m(t.drum.tomL,s-1),onMouseenter:()=>O(t.drum.tomL,s-1)},null,42,Ve)),64))]),o("ul",ze,[(g(),y(k,null,b(16,s=>o("li",{key:`tomM_${s-1}`,name:`tomM_${s-1}`,class:v(["item",{active:!!t.drum.tomM[s-1]}]),onMousedown:c=>m(t.drum.tomM,s-1),onMouseenter:()=>O(t.drum.tomM,s-1)},null,42,Xe)),64))]),o("ul",Ye,[(g(),y(k,null,b(16,s=>o("li",{key:`tomH_${s-1}`,name:`tomH_${s-1}`,class:v(["item",{active:!!t.drum.tomH[s-1]}]),onMousedown:c=>m(t.drum.tomH,s-1),onMouseenter:()=>O(t.drum.tomH,s-1)},null,42,Ke)),64))])],512),[[W,a.value===0]]),K(o("div",We,[(g(!0),y(k,null,b(t.lead,(s,c)=>(g(),y("ul",{key:`lead_${c}`},[(g(),y(k,null,b(16,w=>o("li",{key:`lead_${c}_${w-1}`,name:`lead_${c}_${w-1}`,class:v(["item",{active:!!t.lead[c][w-1]}]),onMousedown:R=>m(t.lead[c],w-1),onMouseenter:()=>O(t.lead[c],w-1)},null,42,Ze)),64))]))),128))],512),[[W,a.value===1]])],32)]))}}),at=Ne(et,[["__scopeId","data-v-990ccf97"]]);export{at as default};

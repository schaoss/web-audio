import{d as h,p as R,b as V,e as N,r as u,c as P,f as e,w as r,q as b,g as k,t as y,v as E,h as T,o as G}from"./index-Dp99J6ZZ.js";import{a as I}from"./audioUnlock-CHVvazkl.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H="/web-audio/assets/Rainy_Day_Games-CO6RkEGs.mp3",F={id:"source"},j={id:"config"},z={class:"audio-note"},J={class:"item"},K={for:"waveType"},L={class:"item"},Q={for:"frequency"},W={class:"item"},X={for:"detune"},Y={class:"item"},Z=h({__name:"Source",setup($){const A=window.AudioContext||window.webkitAudioContext,a=new A,l=a.createGain(),c=u(!1),i=u("0");let n=null,g=null,f=null;const d=u("sine"),p=u(440),v=u(0),C=u(new Float32Array(0));function M(){c.value?S():B()}function w(){x()}function U(){d.value="sine",p.value=440,v.value=0,x()}function B(){c.value=!0,l.connect(a.destination)}function S(){c.value=!1,l.disconnect(a.destination)}function x(){if(i.value==="0"&&n&&"type"in n){const s=n;s.type=d.value,s.frequency.value=p.value,s.detune.value=v.value}}function D(s){f=s,n=a.createMediaStreamSource(s);const t=a.createScriptProcessor(1024,1,1);t.onaudioprocess=o=>{const _=o.inputBuffer.getChannelData(0),q=o.outputBuffer.getChannelData(0);for(let m=0;m<_.length;m++)q[m]=_[m];C.value=q},n.connect(t),t.connect(l)}return R(i,(s,t)=>{switch(c.value&&S(),n&&(t==="0"&&"stop"in n?n.stop():t==="1"?document.querySelector("audio")?.pause():t==="2"&&f?.getAudioTracks()[0].stop()),s){default:case"0":n=a.createOscillator(),n.start(),n.connect(l);break;case"1":{const o=document.querySelector("audio");o.play(),g||(g=a.createMediaElementSource(o)),n=g,n.connect(l);break}case"2":navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(D).catch(o=>console.error(o));break}},{immediate:!0}),V(()=>{I(a),x()}),N(()=>{c.value&&l.disconnect(a.destination),f&&f.getAudioTracks()[0].stop()}),(s,t)=>(G(),P("div",F,[t[11]||(t[11]=e("h1",{class:"text-3xl font-bold text-center my-8 dark:text-white"},"Source",-1)),e("div",{class:"text-center my-4"},[e("button",{class:"btn",onClick:M}," Play / Pause "),e("button",{class:"btn",onClick:U}," Reset ")]),e("div",j,[e("div",z,[e("h3",null,[t[5]||(t[5]=e("span",null,"音源：",-1)),e("select",{onChange:t[0]||(t[0]=o=>i.value=o.target.value),class:"styled-select"},[...t[4]||(t[4]=[e("option",{value:"0"},"振盪器",-1),e("option",{value:"1"},"Audio Tag",-1),e("option",{value:"2"},"麥克風",-1)])],32)]),r(e("div",null,[e("div",J,[e("label",K,[t[6]||(t[6]=k("type : ",-1)),e("span",null,y(d.value),1)]),r(e("select",{id:"waveType","onUpdate:modelValue":t[1]||(t[1]=o=>d.value=o),onChange:w,class:"styled-select"},[...t[7]||(t[7]=[e("option",{value:"sine",selected:""},"sine",-1),e("option",{value:"square"},"square",-1),e("option",{value:"sawtooth"},"sawtooth",-1),e("option",{value:"triangle"},"triangle",-1)])],544),[[E,d.value]])]),e("div",L,[e("label",Q,[t[8]||(t[8]=k("frequency : ",-1)),e("span",null,y(p.value),1)]),r(e("input",{type:"range",min:"0",max:"4000",step:"1",id:"frequencyRange","onUpdate:modelValue":t[2]||(t[2]=o=>p.value=o),onInput:w,class:"accent-primary"},null,544),[[T,p.value]])]),e("div",W,[e("label",X,[t[9]||(t[9]=k("detune : ",-1)),e("span",null,y(v.value),1)]),r(e("input",{type:"range",min:"-2000",max:"2000",step:"1",id:"detuneRange","onUpdate:modelValue":t[3]||(t[3]=o=>v.value=o),onInput:w,class:"accent-primary"},null,544),[[T,v.value]])])],512),[[b,i.value==="0"]]),r(e("div",null,[...t[10]||(t[10]=[e("div",{class:"item"},[e("audio",{id:"player",controls:"",preload:"auto",class:"w-full accent-primary"},[e("source",{src:H,type:"audio/mp3"})])],-1)])],512),[[b,i.value==="1"]]),r(e("div",null,[e("div",Y,y(C.value),1)],512),[[b,i.value==="2"]])])])]))}}),ne=O(Z,[["__scopeId","data-v-fcc44b53"]]);export{ne as default};

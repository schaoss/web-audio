import{a as z}from"./audioUnlock-CHVvazkl.js";import{d as R,r as _,b as I,e as L,c as C,f as n,t as y,l as g,F as P,i as H,n as V,o as b}from"./index-Dp99J6ZZ.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={id:"guitar-tuner"},J={id:"config"},K={class:"audio-note"},Q={class:"result"},W=R({__name:"GuitarTuner_2",setup(Y){const w=window.AudioContext||window.webkitAudioContext,a=new w,d=a.createGain(),s=a.createAnalyser();d.gain.value=0,s.fftSize=2048,s.connect(d);const v=_(!1);let A=null,p=null;const o=_(new Float32Array(s.fftSize/2)),m=_(null),f=_(0),h=g(()=>{const e=o.value.length/2,i=.9,r=new Array(e);let u=-1,M=0,F=1,x=!1;if(o.value.reduce((l,t)=>l+=t**2,0)<.01)return-1;for(let l=0;l<e;l++){let t=0;for(let c=0;c<e;c++)t+=Math.abs(o.value[c]-o.value[c+l]);if(t=1-t/e,r[l]=t,t>i&&t>F)x=!0,t>M&&(M=t,u=l);else if(x){const c=(r[u+1]-r[u-1])/r[u];return Math.round(a.sampleRate/(u+8*c))}F=t}return M>.01?Math.round(a.sampleRate/u):-1}),O=g(()=>h.value>0?h.value:"-"),k=g(()=>{const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return m.value?e[m.value%12]:"-"}),D=g(()=>f.value<0?Math.abs(f.value)+" b":f.value>0?Math.abs(f.value)+" #":"-");function G(){v.value?q():T()}function T(){v.value=!0,d.connect(a.destination),requestAnimationFrame(S)}function q(){v.value=!1,d.disconnect(a.destination)}function B(e){p=e,A=a.createMediaStreamSource(e),A.connect(s)}function S(){o.value=new Float32Array(s.fftSize),s.getFloatTimeDomainData(o.value),m.value=E(h.value),f.value=U(h.value,m.value),v.value&&requestAnimationFrame(S)}function E(e){return Math.round(12*(Math.log(e/440)/Math.log(2)))+69}function N(e){return 440*Math.pow(2,(e-69)/12)}function U(e,i){return Math.floor(1200*Math.log(e/N(i))/Math.log(2))}return I(()=>{z(a),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(B).catch(e=>console.error(e))}),L(()=>{p&&p.getAudioTracks()[0].stop()}),(e,i)=>(b(),C("div",j,[i[0]||(i[0]=n("h1",{class:"text-3xl font-bold text-center my-8 dark:text-white"},"Guitar Tuner 2.0",-1)),n("div",{class:"text-center my-4"},[n("button",{class:"btn",onClick:G}," On / Off ")]),n("div",J,[n("div",K,[n("h3",null,y(O.value),1),n("h2",null,y(k.value),1),n("h4",null,y(D.value),1),n("div",Q,[(b(),C(P,null,H(512,r=>n("div",{class:"fftData",key:r,style:V({height:o.value[r-1]*200+2+"px"})},null,4)),64))])])])]))}}),te=X(W,[["__scopeId","data-v-af4cc1c6"]]);export{te as default};
